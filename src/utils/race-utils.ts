export type RaceTarget = {
    p1: number;
    p2: number;
};

export function calculateRace(rating1: number, rating2: number, gameType: '8ball' | '9ball'): RaceTarget {
    const r1 = rating1 ?? 500;
    const r2 = rating2 ?? 500;

    // 1. Helper Index Logic
    // 0: <= 344
    // 1: <= 436
    // 2: <= 499
    // 3: <= 561
    // 4: <= 624
    // 5: <= 686
    // 6: <= 749
    // 7: <= 875
    // 8: > 875

    const getIndex = (r: number) => {
        if (r <= 344) return 0;
        if (r <= 436) return 1;
        if (r <= 499) return 2;
        if (r <= 561) return 3;
        if (r <= 624) return 4;
        if (r <= 686) return 5;
        if (r <= 749) return 6;
        if (r <= 875) return 7;
        return 8;
    };

    const idx1 = getIndex(r1);
    const idx2 = getIndex(r2);

    // 2. Define Matrix [row][col][p1, p2]
    // Note: In the SQL, it was access by [idx1+1][idx2+1] because SQL is 1-indexed.
    // Here we use 0-indexed arrays.

    let matrix: number[][][];

    if (gameType === '9ball') {
        matrix = [
            // Row 0 (0-344)
            [[3, 3], [3, 4], [3, 4], [3, 5], [3, 5], [3, 6], [3, 6], [3, 8], [2, 8]],
            // Row 1 (345-436)
            [[4, 3], [4, 4], [4, 5], [4, 5], [4, 6], [4, 6], [4, 7], [3, 8], [3, 8]],
            // Row 2 (437-499)
            [[4, 3], [5, 4], [4, 4], [4, 5], [4, 6], [4, 6], [4, 7], [3, 8], [3, 8]],
            // Row 3 (500-561)
            [[5, 3], [5, 4], [5, 4], [5, 5], [5, 6], [5, 6], [5, 7], [5, 8], [4, 8]],
            // Row 4 (562-624)
            [[5, 3], [6, 4], [6, 4], [6, 5], [6, 6], [5, 6], [5, 7], [5, 8], [4, 8]],
            // Row 5 (625-686)
            [[6, 3], [6, 5], [6, 5], [6, 5], [6, 5], [6, 6], [6, 7], [5, 8], [5, 8]],
            // Row 6 (687-749)
            [[6, 3], [7, 4], [7, 5], [7, 5], [7, 5], [7, 6], [6, 6], [6, 8], [5, 8]],
            // Row 7 (750-875)
            [[8, 3], [8, 3], [7, 4], [8, 5], [8, 5], [8, 6], [8, 6], [7, 7], [7, 8]],
            // Row 8 (876+)
            [[8, 2], [8, 3], [8, 3], [8, 3], [8, 4], [8, 5], [8, 5], [8, 7], [9, 9]]
        ];
    } else {
        // 8-Ball Matrix
        matrix = [
            // Row 0 (0-344)
            [[3, 3], [3, 4], [3, 5], [3, 5], [3, 6], [3, 6], [3, 7], [3, 7], [2, 7]],
            // Row 1 (345-436)
            [[4, 3], [4, 4], [4, 4], [4, 5], [4, 5], [4, 6], [3, 6], [3, 6], [3, 7]],
            // Row 2 (437-499)
            [[5, 3], [4, 4], [4, 4], [4, 5], [4, 5], [4, 6], [4, 6], [3, 6], [3, 7]],
            // Row 3 (500-561)
            [[5, 3], [5, 4], [5, 4], [5, 5], [5, 5], [4, 6], [4, 6], [4, 6], [3, 7]],
            // Row 4 (562-624)
            [[6, 3], [5, 4], [5, 4], [5, 5], [5, 5], [5, 6], [4, 6], [4, 6], [4, 7]],
            // Row 5 (625-686)
            [[6, 3], [6, 4], [6, 4], [6, 4], [6, 5], [5, 5], [5, 6], [5, 6], [4, 7]],
            // Row 6 (687-749)
            [[7, 3], [6, 3], [6, 4], [6, 4], [6, 4], [6, 5], [5, 5], [5, 6], [5, 7]],
            // Row 7 (750-875)
            [[7, 3], [6, 3], [6, 3], [6, 4], [6, 4], [6, 5], [6, 5], [6, 6], [6, 7]],
            // Row 8 (876+)
            [[7, 2], [7, 3], [7, 3], [7, 3], [7, 4], [7, 4], [7, 5], [7, 6], [7, 7]]
        ];
    }

    const [race1, race2] = matrix[idx1][idx2];

    return {
        p1: race1,
        p2: race2
    };
}
